# é«˜æ€§èƒ½å®æ—¶è·¯å¾„æ¸²æŸ“æ–¹æ¡ˆ

åŸºäº **WebGL + Web Worker + Konva** çš„å¤§è§„æ¨¡å®æ—¶ç‚¹ä½æ¸²æŸ“è§£å†³æ–¹æ¡ˆï¼Œä¸“ä¸ºå¤„ç† **10ä¸‡+æœºå™¨äººè½¨è¿¹ç‚¹** è®¾è®¡ï¼Œç¨³å®šä¿æŒ **55-60 FPS**ã€‚

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

- **æ€§èƒ½çªç ´**: 10ä¸‡ç‚¹ä½ @55-60 FPSï¼ˆä¼ ç»Ÿ Canvas2D/Konva æ–¹æ¡ˆ <5 FPSï¼‰
- **æ•°é‡çº§æå‡**: ç›¸æ¯”ä¼ ç»Ÿ Konva æ–¹æ¡ˆï¼Œæ¸²æŸ“ç‚¹æ•°æå‡ **20å€**ï¼Œå¸§ç‡æå‡ **6å€**
- **ä¸‰å±‚åˆ†ç¦»æ¶æ„**: Worker ç¦»å±è®¡ç®— + WebGL GPUæ¸²æŸ“ + Konva UIäº¤äº’
- **é›¶æ‹·è´ä¼ è¾“**: Transferable Objects å®ç° Worker ä¸ä¸»çº¿ç¨‹é«˜æ•ˆé€šä¿¡
- **æ™ºèƒ½å†…å­˜ç®¡ç†**: ç¯å½¢ç¼“å†²åŒºé¢„åˆ†é…ï¼Œé›¶ GC å‹åŠ›
- **å†·çƒ­æ•°æ®ç»Ÿä¸€**: WebSocket å®æ—¶æ¨é€ï¼ˆçƒ­æ•°æ®ï¼‰+ å†å²è½¨è¿¹å­˜å‚¨ï¼ˆå†·æ•°æ®ï¼‰

## ğŸ“¦ å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨yarnå®‰è£…ä¾èµ–
yarn install
```

## ğŸ¯ è¿è¡Œé¡¹ç›®

```bash
# å¼€å‘æ¨¡å¼
yarn dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
yarn build

# é¢„è§ˆæ„å»ºç»“æœ
yarn preview
```

é¡¹ç›®é»˜è®¤è¿è¡Œåœ¨ http://localhost:3000

## ğŸ® ä½¿ç”¨è¯´æ˜

### æ§åˆ¶é¢æ¿
- **å¼€å§‹/åœæ­¢æ¨¡æ‹Ÿ**: æ§åˆ¶æ•°æ®æµçš„å¼€å§‹å’Œåœæ­¢
- **WSé—´éš”**: è°ƒæ•´WebSocketå‘é€é—´éš”ï¼ˆ50/100/200msï¼‰
- **æ¯æ¡æ¶ˆæ¯ç‚¹æ•°**: æ§åˆ¶æ¯æ‰¹å‘é€çš„ç‚¹æ•°é‡
- **LODåƒç´ é˜ˆå€¼**: è°ƒæ•´ç»†èŠ‚å±‚æ¬¡çš„åˆå¹¶é˜ˆå€¼

### é”®ç›˜å¿«æ·é”®
- `G`: æ˜¾ç¤º/éšè—ç½‘æ ¼
- `C`: æ˜¾ç¤º/éšè—ä¸­å¿ƒåå­—å‡†æ˜Ÿ
- `M`: æ˜¾ç¤º/éšè—å°åœ°å›¾
- `R`: é‡ç½®è§†å›¾

### é¼ æ ‡äº¤äº’
- **æ»šè½®**: ç¼©æ”¾è§†å›¾
- **å·¦é”®æ‹–æ‹½**: å¹³ç§»è§†å›¾
- **é¼ æ ‡ç§»åŠ¨**: æ˜¾ç¤ºä¸–ç•Œåæ ‡

## ğŸ—ï¸ ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Konva å±‚ï¼ˆUIäº¤äº’å±‚ï¼‰                    â”‚  â† é¼ æ ‡/è§¦æ‘¸äº¤äº’ã€åæ ‡æ˜¾ç¤ºã€ç½‘æ ¼è¦†ç›–
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  WebGL å±‚ï¼ˆGPUæ¸²æŸ“å±‚ï¼‰                   â”‚  â† 10ä¸‡ç‚¹é«˜æ€§èƒ½æ¸²æŸ“ã€Shaderç€è‰²
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Worker å±‚ï¼ˆç¦»å±è®¡ç®—å±‚ï¼‰                 â”‚  â† LODã€ç©ºé—´è£å‰ªã€æ•°æ®é¢„å¤„ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸ºä»€ä¹ˆä¸ç”¨ä¼ ç»Ÿ Konva æ–¹æ¡ˆï¼Ÿ

| æŒ‡æ ‡ | ä¼ ç»Ÿ Konva | æœ¬æ–¹æ¡ˆ | æå‡ |
|------|-----------|--------|------|
| æœ€å¤§ç‚¹æ•° | ~5,000 | 100,000+ | **20å€** |
| å¸§ç‡ | <10 FPS | 55-60 FPS | **6å€** |
| å†…å­˜å ç”¨ | ä¸å¯æ§ï¼ˆæ¯ç‚¹åˆ›å»º Shape å¯¹è±¡ï¼‰ | å›ºå®š ~50MBï¼ˆé¢„åˆ†é…ï¼‰ | **å¯é¢„æµ‹** |
| CPU å ç”¨ | 100%ï¼ˆé€ç‚¹ç»˜åˆ¶é˜»å¡ä¸»çº¿ç¨‹ï¼‰ | <30%ï¼ˆWorker åˆ†æ‹…ï¼‰ | **é‡Šæ”¾ä¸»çº¿ç¨‹** |
| å®æ—¶æ€§ | æ•°æ®åºåˆ—åŒ–å¡é¡¿ | é›¶æ‹·è´ä¼ è¾“æµç•… | **æ— å»¶è¿Ÿ** |

**æ ¸å¿ƒé—®é¢˜**ï¼šKonva åŸºäº Canvas2Dï¼Œæ¯ä¸ªç‚¹éœ€è¦åˆ›å»º Shape å¯¹è±¡å¹¶é€ä¸ªè°ƒç”¨ç»˜åˆ¶ APIï¼Œ10ä¸‡ç‚¹ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºä¸”å¸§ç‡å´©æºƒã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šå°† Konva é™çº§ä¸º**çº¯äº¤äº’å±‚**ï¼ˆæ•è·é¼ æ ‡/é”®ç›˜äº‹ä»¶ï¼‰ï¼Œè·¯å¾„æ¸²æŸ“å…¨éƒ¨ç”± WebGL çš„ GPU å¹¶è¡Œå®Œæˆã€‚

---

## ğŸ”§ æŠ€æœ¯æ¶æ„è¯¦è§£

### 1. æ•°æ®æµç¨‹ï¼ˆçƒ­æ•°æ® - WebSocket å®æ—¶æ¨é€ï¼‰

```
WebSocketæ¨¡æ‹Ÿå™¨ï¼ˆ50ms/æ‰¹ï¼Œ100ç‚¹ï¼‰
    â†“ äºŒè¿›åˆ¶æ ¼å¼ ArrayBuffer
dataProcessor.worker.jsï¼ˆLOD + ç©ºé—´è£å‰ª + æ ¼å¼è½¬æ¢ï¼‰
    â†“ Transferable é›¶æ‹·è´ä¼ è¾“
WebGLRenderer.updatePoints()ï¼ˆè§£æå¹¶æŒ‰æœºå™¨äººåˆ†ç»„ï¼‰
    â†“ æ‰“åŒ…åˆ°æš‚å­˜åŒº _stagingPos/_stagingColorU8
GPU ç¼“å†²åŒºï¼ˆbufferSubData å¢é‡æ›´æ–°ï¼‰
    â†“ Shader æŠ•å½±å˜æ¢
å±å¹•æ¸²æŸ“ï¼ˆLINE_STRIP ä¸€æ¬¡ drawArraysï¼‰
```

**å…³é”®æŠ€æœ¯**ï¼š
- **äºŒè¿›åˆ¶ä¼ è¾“**ï¼šæ¯ç‚¹ 28 å­—èŠ‚ï¼ˆ7Ã—Float32ï¼š`x, y, r, g, b, a, robotId`ï¼‰
- **é›¶æ‹·è´**ï¼š`postMessage(buffer, [buffer])` è½¬ç§» ArrayBuffer æ‰€æœ‰æƒï¼Œé¿å…åºåˆ—åŒ–
- **å¢é‡æ›´æ–°**ï¼š`bufferSubData` åªæ›´æ–°å˜åŒ–éƒ¨åˆ†ï¼Œä¸é‡å»ºæ•´ä¸ª GPU ç¼“å†²åŒº

### 2. å†·æ•°æ®å¤„ç†ï¼ˆå†å²è·¯å¾„å­˜å‚¨ï¼‰

```javascript
// RobotPathManager.js - ç¯å½¢ç¼“å†²åŒº
class RobotPath {
  vertices: Float32Array(100000 * 2)  // é¢„åˆ†é…å•æœºå™¨äºº10ä¸‡ç‚¹å®¹é‡
  colors: Float32Array(100000 * 4)    // RGBAé¢œè‰²
  writeIndex: number                  // å¾ªç¯å†™å…¥æŒ‡é’ˆ
}
```

**å­˜å‚¨ç­–ç•¥**ï¼š
- **é¢„åˆ†é…å†…å­˜**ï¼šå¯åŠ¨æ—¶ä¸€æ¬¡æ€§åˆ†é…ï¼Œè¿è¡Œæ—¶é›¶ GC
- **ç¯å½¢è¦†ç›–**ï¼šæ»¡å®¹åè¦†ç›–æœ€æ—§æ•°æ®ï¼ˆFIFOï¼‰ï¼Œä¿ç•™æœ€æ–°è½¨è¿¹
- **æŒ‰æœºå™¨äººåˆ†ç»„**ï¼šæ¯ä¸ªæœºå™¨äººç‹¬ç«‹ç¼“å†²åŒºï¼ˆæ”¯æŒ 10 ä¸ªæœºå™¨äººï¼‰
- **GPU å¸¸é©»**ï¼šå†å²æ•°æ®å§‹ç»ˆåœ¨ GPUï¼Œæ¯å¸§ç»Ÿä¸€æ¸²æŸ“å†·+çƒ­æ•°æ®

**å†·çƒ­ç»Ÿä¸€æ¸²æŸ“**ï¼š`_packRobotsToStaging()` å°†æ‰€æœ‰æœºå™¨äººè·¯å¾„æ‰“åŒ…åˆ°æš‚å­˜åŒºï¼Œä¸€æ¬¡æ€§ä¸Šä¼  GPUï¼Œç”¨ `LINE_STRIP` ç»˜åˆ¶è¿ç»­è·¯å¾„ã€‚

### 3. Web Worker ä¸‰å¤§èŒè´£

#### 3.1 LODï¼ˆLevel of Detailï¼‰å¤„ç†
```javascript
// dataProcessor.worker.js:321-412
// ç©ºé—´åˆ†åŒºç®—æ³•ä¼˜åŒ–ï¼šO(nÂ²) â†’ O(n)
æ ¹æ®ç¼©æ”¾çº§åˆ«è‡ªåŠ¨åˆå¹¶å¯†é›†ç‚¹ï¼š
- æ”¾å¤§æ—¶ï¼šæ˜¾ç¤ºæ‰€æœ‰ç»†èŠ‚
- ç¼©å°æ—¶ï¼šç½‘æ ¼èšç±»åˆå¹¶ä¸´è¿‘ç‚¹ï¼ˆå‡å°‘ç»˜åˆ¶è´Ÿæ‹…ï¼‰
```

#### 3.2 ç©ºé—´è£å‰ª
```javascript
// cullPoints() - è§†å£å¤–ç‚¹è¿‡æ»¤
è®¡ç®—ä¸–ç•Œåæ ‡è¾¹ç•Œ â†’ è¿‡æ»¤è§†å£å¤–çš„ç‚¹ â†’ å‡å°‘ 50%+ æ¸²æŸ“è´Ÿæ‹…
```

#### 3.3 æ•°æ®æ ¼å¼æ ‡å‡†åŒ–
```javascript
// è¾“å…¥ï¼šJSON æˆ– 12å­—èŠ‚äºŒè¿›åˆ¶ï¼ˆæ—§æ ¼å¼ï¼‰
// è¾“å‡ºï¼š28å­—èŠ‚ç»Ÿä¸€æ ¼å¼ï¼ˆx,y,r,g,b,a,robotIdï¼‰
ä¿è¯ WebGL æ¥æ”¶æ ‡å‡†åŒ–æ•°æ®
```

**ä¸ºä»€ä¹ˆç”¨ Workerï¼Ÿ**  
è¿™äº›è®¡ç®—åœ¨ä¸»çº¿ç¨‹ä¼šé˜»å¡æ¸²æŸ“ï¼ˆæ‰å¸§ï¼‰ï¼ŒWorker åœ¨åå°çº¿ç¨‹å¹¶è¡Œå¤„ç†ï¼Œä¸»çº¿ç¨‹ä¸“æ³¨ 60fps æ¸²æŸ“å¾ªç¯ã€‚

### 4. WebGL + Shader æ¸²æŸ“å¼•æ“

#### WebGLï¼ˆGPU æ¸²æŸ“ç®¡çº¿ï¼‰
```javascript
// WebGLRenderer.js
- é¢„åˆ†é… 100ä¸‡ç‚¹ GPU ç¼“å†²åŒºï¼ˆbufferDataï¼Œ6MB VRAMï¼‰
- æ¯å¸§åªæ›´æ–°å˜åŒ–éƒ¨åˆ†ï¼ˆbufferSubDataï¼Œ<0.2msï¼‰
- VAO æ‰¹é‡ç»‘å®šé¡¶ç‚¹å±æ€§ï¼ˆå‡å°‘çŠ¶æ€åˆ‡æ¢ï¼‰
- LINE_STRIP æ¨¡å¼ç»˜åˆ¶è¿ç»­è·¯å¾„ï¼ˆä¸€æ¬¡ drawArraysï¼‰
```

#### Shaderï¼ˆGPU ç€è‰²å™¨ç¨‹åºï¼‰

**é¡¶ç‚¹ç€è‰²å™¨**ï¼ˆPathShader.jsï¼‰ï¼š
```glsl
// ä¸–ç•Œåæ ‡ â†’ å±å¹•åæ ‡
1. æ•°æ®è¾¹ç•Œå½’ä¸€åŒ–ï¼ˆdataBounds: minX, maxX, minY, maxYï¼‰
2. åº”ç”¨è§†å›¾å˜æ¢ï¼ˆç¼©æ”¾ scaleã€å¹³ç§» translateï¼‰
3. æŠ•å½±åˆ° NDC åæ ‡ç³»ï¼ˆ-1 åˆ° 1ï¼‰
```

**ç‰‡æ®µç€è‰²å™¨**ï¼ˆPathShader.jsï¼‰ï¼š
```glsl
// ç€è‰²ä¸é€æ˜åº¦æ··åˆ
ç›´æ¥è¾“å‡ºé¡¶ç‚¹é¢œè‰²ï¼ˆæ”¯æŒ Alpha é€šé“æ··åˆï¼‰
```

**å‘¼å¸ç¯ç€è‰²å™¨**ï¼ˆMarkerShader.jsï¼‰ï¼š
```glsl
// æœºå™¨äººå½“å‰ä½ç½®æ ‡è®°
ä½¿ç”¨ sin(time) å®ç°è„‰å†²åŠ¨ç”»ï¼ˆç‚¹ç²¾çµ POINTS æ¸²æŸ“ï¼‰
```

**ä¸ºä»€ä¹ˆç”¨ WebGLï¼Ÿ**  
- Canvas2D ç»˜åˆ¶ 10ä¸‡ç‚¹éœ€è¦ 10ä¸‡æ¬¡ API è°ƒç”¨ï¼ˆ>500ms/å¸§ï¼Œå¡æ­»ï¼‰
- WebGL ä¸€æ¬¡ `drawArrays` ç»˜åˆ¶æ‰€æœ‰ç‚¹ï¼ˆ<0.2ms/å¸§ï¼‰ï¼ŒGPU å¹¶è¡Œå¤„ç†

### 5. Konva çš„è½»é‡åŒ–è§’è‰²

**å½“å‰èŒè´£**ï¼ˆä»… UI äº¤äº’å±‚ï¼‰ï¼š
1. **äº¤äº’æ•è·**ï¼šé¼ æ ‡æ»šè½®ç¼©æ”¾ã€æ‹–æ‹½å¹³ç§»ã€è§¦æ‘¸äº‹ä»¶
2. **UI è¦†ç›–å±‚**ï¼šåæ ‡æ˜¾ç¤ºã€FPS ç»Ÿè®¡ã€ç½‘æ ¼ã€åå­—å‡†æ˜Ÿ
3. **è§†å›¾å˜æ¢åŒæ­¥**ï¼šå°†ç”¨æˆ·æ“ä½œè½¬æ¢ä¸º `transform {x, y, scale}` ä¼ é€’ç»™ WebGL

```javascript
// KonvaLayer.js:249-275
stage.on('wheel', (e) => {
  // è®¡ç®—ç¼©æ”¾å’Œå¹³ç§»
  this.transform = { x, y, scale }
  // é€šçŸ¥ WebGL æ›´æ–°å˜æ¢çŸ©é˜µ
  this.onTransformChangeCallback(this.transform)
})
```

**ä¸è´Ÿè´£æ¸²æŸ“è·¯å¾„**ï¼šé¿å… Konva çš„ Shape å¯¹è±¡åˆ›å»ºå’Œé€ç‚¹ç»˜åˆ¶å¼€é”€ã€‚

---

## âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. ç¯å½¢ç¼“å†²åŒºï¼ˆé¿å…å†…å­˜åˆ†é…ï¼‰
```javascript
// å¯åŠ¨æ—¶é¢„åˆ†é… 100ä¸‡ç‚¹ Ã— 12å­—èŠ‚ = 12MB
// è¿è¡Œæ—¶é›¶ mallocï¼Œå†™å…¥æŒ‡é’ˆå¾ªç¯ç§»åŠ¨
writeIndex = (writeIndex + 1) % capacity
```

### 2. Transferable Objectsï¼ˆé›¶æ‹·è´ä¼ è¾“ï¼‰
```javascript
// Worker â†’ ä¸»çº¿ç¨‹
const buffer = new ArrayBuffer(...)
postMessage(buffer, [buffer])  // è½¬ç§»æ‰€æœ‰æƒï¼Œä¸å¤åˆ¶
```

### 3. æ‰¹é‡ GPU ä¸Šä¼ ï¼ˆå‡å°‘ Draw Callï¼‰
```javascript
// æ‰“åŒ…æ‰€æœ‰æœºå™¨äººè·¯å¾„ â†’ å•æ¬¡ bufferSubData
// å¤šæ®µ LINE_STRIP â†’ ä¸€æ¬¡ drawArrays è°ƒç”¨
for (const seg of packedDraws) {
  gl.drawArrays(gl.LINE_STRIP, seg.start, seg.count)
}
```

### 4. LOD ç©ºé—´åˆ†åŒºï¼ˆO(n) ç®—æ³•ï¼‰
```javascript
// ç½‘æ ¼å“ˆå¸Œ + 3Ã—3 é‚»åŸŸæœç´¢
// 1ä¸‡ç‚¹ï¼šä» 5000ä¸‡æ¬¡æ¯”è¾ƒ â†’ 30æ¬¡æ¯”è¾ƒ
const grid = new Map()
for (const p of points) {
  const key = `${Math.floor(p.x / cellSize)},${Math.floor(p.y / cellSize)}`
  grid.get(key).push(p)
}
```

### 5. è‡ªé€‚åº”é…ç½®ï¼ˆæ™ºèƒ½é™çº§ï¼‰
```javascript
// App.vue - è‡ªé€‚åº” LOD
if (fps < 45) lodThreshold += 0.5  // é™ä½ç‚¹æ•°ï¼Œæå‡å¸§ç‡
if (fps > 55) lodThreshold -= 0.2  // æå‡ç”»è´¨
```

### 6. é¢„ç®—åˆ‡ç‰‡ï¼ˆç‚¹æ•°ä¸ç¡®å®šåœºæ™¯ï¼‰
```javascript
// WebGLRenderer._packRobotsToStaging()
// æ€»ç‚¹æ•°è¶…è¿‡ MAX_POINTS æ—¶ï¼ŒæŒ‰æœºå™¨äººå‡åˆ†é¢„ç®—
// åªä¿ç•™æ¯ä¸ªæœºå™¨äººçš„"æœ«å°¾æœ€æ–°æ®µ"
if (total > MAX_POINTS) {
  perCap = Math.floor(MAX_POINTS / robots.length)
  keep = Math.min(count, perCap)  // ä¿ç•™æœ€æ–°æ•°æ®
}
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡ä¸æµ‹è¯•æ•°æ®

### å®æµ‹æ€§èƒ½
- **æ¸²æŸ“ç‚¹æ•°**: 100,000 ç‚¹
- **ç¨³å®šå¸§ç‡**: 55-60 FPS
- **WebGL æ¸²æŸ“è€—æ—¶**: 0.1~0.2 ms/å¸§ âœ…
- **Worker å¤„ç†è€—æ—¶**: 0.1~0.3 ms/æ‰¹æ¬¡ âœ…
- **bufferSubData è€—æ—¶**: 0.1~0.2 ms/å¸§ âœ…
- **å†…å­˜å ç”¨**: ~50 MBï¼ˆé¢„åˆ†é…ç¼“å†²åŒºï¼‰
- **CPU å ç”¨**: <30%ï¼ˆä¸»çº¿ç¨‹ + Worker åˆ†æ‹…ï¼‰

### å®¹é‡ä¸Šé™
- **GPU ç¼“å†²åŒº**: 1,000,000 ç‚¹é¢„åˆ†é…ï¼ˆå¯é…ç½®ï¼‰
- **å•æœºå™¨äººå†å²**: 100,000 ç‚¹ç¯å½¢ç¼“å†²
- **æœ€å¤§æœºå™¨äººæ•°**: 10 ä¸ªï¼ˆå¯æ‰©å±•ï¼‰
- **æ•°æ®æ›´æ–°é¢‘ç‡**: 20 Hzï¼ˆ50ms é—´éš”ï¼‰

### å‹åŠ›æµ‹è¯•åœºæ™¯

**åŸºç¡€æµ‹è¯•**ï¼š
- æ­£å¸¸æµé‡ï¼šæ¯ 50ms å‘é€ 100 ç‚¹
- æŒç»­è¿è¡Œï¼šç´¯ç§¯åˆ° 10 ä¸‡ç‚¹ç¨³å®š 55+ FPS

**å‹åŠ›æµ‹è¯•**ï¼š
- é«˜å¯†åº¦åœºæ™¯ï¼šç´¯ç§¯åˆ° 20 ä¸‡ç‚¹ï¼ˆè‡ªåŠ¨é¢„ç®—åˆ‡ç‰‡ï¼‰
- é«˜é¢‘æ›´æ–°ï¼šæ¯ 50ms å‘é€ 1000 ç‚¹
- æé™æµ‹è¯•ï¼šç¬æ—¶å‘é€ 1 ä¸‡ç‚¹ï¼ˆåˆ†æ‰¹å¤„ç†ï¼‰

**æ€§èƒ½ç›‘æ§**ï¼šæ§åˆ¶é¢æ¿å®æ—¶æ˜¾ç¤ºå½“å‰æ€»ç‚¹æ•°ã€å®æ—¶ FPSã€bufferSubData è€—æ—¶ã€Worker å¤„ç†è€—æ—¶ã€æ¸²æŸ“è€—æ—¶ï¼Œæ”¯æŒå¯¼å‡º JSON æ ¼å¼æ€§èƒ½æŠ¥å‘Šã€‚

---

## ğŸ” æ•°æ®æ ¼å¼åè®®

### ç»Ÿä¸€æ•°æ®æ ¼å¼ï¼ˆ28å­—èŠ‚/ç‚¹ï¼‰

```text
[ç‚¹æ•°é‡ (4å­—èŠ‚ Uint32 LE)] + [ç‚¹æ•°æ®æ•°ç»„]

æ¯ä¸ªç‚¹ 28 å­—èŠ‚ï¼š
  - x        (4å­—èŠ‚ Float32)  // ä¸–ç•Œåæ ‡X
  - y        (4å­—èŠ‚ Float32)  // ä¸–ç•Œåæ ‡Y
  - r        (4å­—èŠ‚ Float32)  // çº¢è‰²åˆ†é‡ [0-1]
  - g        (4å­—èŠ‚ Float32)  // ç»¿è‰²åˆ†é‡ [0-1]
  - b        (4å­—èŠ‚ Float32)  // è“è‰²åˆ†é‡ [0-1]
  - a        (4å­—èŠ‚ Float32)  // é€æ˜åº¦ [0-1]
  - robotId  (4å­—èŠ‚ Float32)  // æœºå™¨äººID
```

### Worker æ¶ˆæ¯åè®®

```javascript
// é…ç½®æ¶ˆæ¯
{ type: 'config', lodThreshold, viewBounds, maxPoints }

// å¤„ç†æ¶ˆæ¯ï¼ˆçƒ­æ•°æ®ï¼‰
{ type: 'process', points: ArrayBuffer, transform: {x, y, scale} }

// æ¸…ç©ºæ¶ˆæ¯
{ type: 'clear' }

// å“åº”æ¶ˆæ¯ï¼ˆè¿”å›ä¸»çº¿ç¨‹ï¼‰
{ 
  type: 'processed', 
  data: ArrayBuffer,  // 28å­—èŠ‚æ ¼å¼
  stats: { processTime, inputPoints, outputPoints, totalPoints }
}
```

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```text
realtime-path-renderer/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.vue                      # ä¸»åº”ç”¨ç»„ä»¶ï¼ˆé›†æˆä¸‰å±‚æ¶æ„ï¼‰
â”‚   â”œâ”€â”€ main.js                      # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ renderer/                    # æ¸²æŸ“å™¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ WebGLRenderer.js         # WebGL GPU æ¸²æŸ“å¼•æ“
â”‚   â”‚   â”œâ”€â”€ KonvaLayer.js            # Konva UI äº¤äº’å±‚
â”‚   â”‚   â”œâ”€â”€ RobotPathManager.js      # æœºå™¨äººè·¯å¾„ç®¡ç†å™¨ï¼ˆç¯å½¢ç¼“å†²ï¼‰
â”‚   â”‚   â”œâ”€â”€ RobotMarkers.js          # æœºå™¨äººæ ‡è®°æ¸²æŸ“ï¼ˆå‘¼å¸ç¯ï¼‰
â”‚   â”‚   â””â”€â”€ shaders/                 # Shader ç€è‰²å™¨
â”‚   â”‚       â”œâ”€â”€ PathShader.js        # è·¯å¾„æ¸²æŸ“ Shader
â”‚   â”‚       â”œâ”€â”€ MarkerShader.js      # æ ‡è®°å‘¼å¸ç¯ Shader
â”‚   â”‚       â””â”€â”€ ShaderCompiler.js    # Shader ç¼–è¯‘å™¨
â”‚   â”œâ”€â”€ simulator/                   # æ•°æ®æ¨¡æ‹Ÿå™¨
â”‚   â”‚   â”œâ”€â”€ WebSocketSimulator.js    # WebSocket æ¨¡æ‹Ÿå™¨ï¼ˆæ—§æ ¼å¼ï¼‰
â”‚   â”‚   â””â”€â”€ simulator.worker.js      # çœŸå®è¿åŠ¨æ¨¡æ‹Ÿå™¨ï¼ˆWorkerç‰ˆï¼‰
â”‚   â”œâ”€â”€ workers/                     # Web Worker
â”‚   â”‚   â””â”€â”€ dataProcessor.worker.js  # æ•°æ®é¢„å¤„ç†ï¼ˆLOD + è£å‰ªï¼‰
â”‚   â”œâ”€â”€ utils/                       # å·¥å…·æ¨¡å—
â”‚   â”‚   â””â”€â”€ PathTracker.js           # é•œå¤´è·Ÿéšæ§åˆ¶
â”‚   â””â”€â”€ components/                  # UI ç»„ä»¶
â”‚       â””â”€â”€ PerformanceChart.vue     # æ€§èƒ½ç›‘æ§å›¾è¡¨
â”œâ”€â”€ PERFORMANCE_OPTIMIZATION.md      # æ€§èƒ½ä¼˜åŒ–è®°å½•
â”œâ”€â”€ package.json                     # é¡¹ç›®é…ç½®
â”œâ”€â”€ vite.config.js                   # Vite é…ç½®
â””â”€â”€ README.md                        # è¯´æ˜æ–‡æ¡£
```

---

## ğŸ¯ é€‚ç”¨åœºæ™¯

- **AGV/æœºå™¨äººè°ƒåº¦ç³»ç»Ÿ**ï¼šå®æ—¶ç›‘æ§å¤§è§„æ¨¡æœºå™¨äººè½¨è¿¹
- **ç‰©æµå¯è§†åŒ–**ï¼šä»“åº“å†…æœºå™¨äººè·¯å¾„è¿½è¸ª
- **æ¸¸æˆå¼€å‘**ï¼šå¤§è§„æ¨¡å•ä½ç§»åŠ¨è½¨è¿¹æ¸²æŸ“
- **åœ°ç†ä¿¡æ¯ç³»ç»Ÿ**ï¼šGPS è½¨è¿¹å®æ—¶å¯è§†åŒ–
- **IoT è®¾å¤‡ç›‘æ§**ï¼šç‰©è”ç½‘è®¾å¤‡è¿åŠ¨è½¨è¿¹å±•ç¤º

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### ä½ç«¯è®¾å¤‡ä¼˜åŒ–
1. **é™ä½æ›´æ–°é¢‘ç‡**ï¼šå°† WS é—´éš”è°ƒæ•´åˆ° 100-200ms
2. **å‡å°‘ç‚¹å¯†åº¦**ï¼šè°ƒæ•´æ¯æ‰¹ç‚¹æ•°åˆ° 50 ä»¥ä¸‹
3. **å¯ç”¨æ€§èƒ½æ¨¡å¼**ï¼šå…³é—­å‘¼å¸ç¯åŠ¨ç”»
4. **æé«˜ LOD é˜ˆå€¼**ï¼šå¢å¤§ `lodThreshold` åˆ° 5-10px

### æé™æ€§èƒ½åœºæ™¯
1. **å¤š VBO åˆ†ç‰‡**ï¼šå°†è·¯å¾„æ•°æ®åˆ‡åˆ†åˆ°å¤šä¸ª GPU ç¼“å†²åŒº
2. **OffscreenCanvas**ï¼šå°† WebGL æ¸²æŸ“ç§»è‡³ Worker çº¿ç¨‹
3. **WebGPU è¿ç§»**ï¼šä½¿ç”¨ä¸‹ä¸€ä»£å›¾å½¢ APIï¼ˆå®éªŒæ€§ï¼‰

---

## ğŸ› å·²çŸ¥é™åˆ¶

1. **é›†æˆæ˜¾å¡**ï¼šæŸäº›é›†æˆæ˜¾å¡å¯èƒ½æ€§èƒ½ä¸‹é™ï¼ˆå»ºè®®ç‹¬æ˜¾ï¼‰
2. **Safari æ”¯æŒ**ï¼šSafari æµè§ˆå™¨çš„ WebGL2 æ”¯æŒæœ‰é™
3. **ç§»åŠ¨è®¾å¤‡**ï¼šå»ºè®®é™ä½ç‚¹æ•°é™åˆ¶åˆ° 5 ä¸‡ä»¥ä¸‹
4. **æµè§ˆå™¨å…¼å®¹**ï¼šéœ€è¦ WebGL2 æ”¯æŒï¼ˆChrome 56+, Firefox 51+ï¼‰

---

## ğŸ“š æŠ€æœ¯å‚è€ƒ

- [WebGL Best Practices - MDN](https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/WebGL_best_practices)
- [Web Workers API - MDN](https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API)
- [Transferable Objects - HTML Spec](https://html.spec.whatwg.org/multipage/structured-data.html#transferable-objects)
- [Konva Performance Tips](https://konvajs.org/docs/performance/All_Performance_Tips.html)
- [Chrome Performance Profiling](https://developer.chrome.com/docs/devtools/performance/)

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

**æ”¹è¿›æ–¹å‘**ï¼š
- æ”¯æŒæ›´å¤šæ¸²æŸ“æ¨¡å¼ï¼ˆä¸‰è§’å½¢å¸¦ã€çƒ­åŠ›å›¾ï¼‰
- è·¯å¾„å†å²å›æ”¾åŠŸèƒ½
- æ•°æ®å¯¼å…¥/å¯¼å‡º
- ç§»åŠ¨ç«¯æ€§èƒ½ä¼˜åŒ–
- WebGPU é€‚é…
